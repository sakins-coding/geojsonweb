<!DOCTYPE html>
<html>
<head>
	<title>GeoJSON Web Demo - Atlas</title>
	
	<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

    <link rel="stylesheet" type="text/css" href="css/atlas.css" />
    <link rel="stylesheet" href="js/leaflet/leaflet.css" crossorigin=""/>
    <script src="js/leaflet/leaflet.js" crossorigin=""></script>
    <script src="js/jquery-3.7.1.min.js" crossorigin=""></script>
	<script type="text/javascript" src="./js/geojsonmap.js"></script>

</head>
<body>
    <div class="wrapper">
        <div class="headerwrap">
        <div class="header">
            <img src="images/geojsonweb_logo.png" alt="GeoJSON Web Logo" height=75px padding=15px/>
        </div>
        </div>
        <div class="leftcolumnwrap">
        <div class="leftcolumn">
            <h1>Atlas</h1>
			<p>This map displays the location where artworks were either completed or inspired by</p>
			<p>You can click on the pin location to see a pop up with the name of the artwork and a preview image.</p>
            <p>Click on the link or image in the pop up for more details about that artwork</p>
	    <button id="list" onclick="list()">List</button>
        </div>
        </div>
        <div class="contentwrap">
        <div class="content">
            <div class="leaflet-container" id='map'></div>
        </div>
        </div>
    </div>

    <script>
    	getGeoJSON('./data/test.json');

	async function list() {
    const query = `
        {
            geojsonweb {
                items {
                    id
                    name
                    image
                    width
                    height
                    units
                    media
                    origin
                }
            }
        }
    `;

    const endpoint = "/data-api/graphql";
    try {
        const response = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("GraphQL response:", result);


        if (result.data && result.data.geojsonweb && result.data.geojsonweb.items) {
            console.table(result.data.geojsonweb.items);
        } else {
            throw new Error("Invalid response structure from server");
        }
    } catch (error) {
        console.error("Error fetching or parsing data:", error);
    }
}
	
        atlas();
    </script>

</body>
</html>
